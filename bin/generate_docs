#!/bin/sh

BIN=`dirname $0`
cd $BIN
cd ..
TOP=`pwd`
#SRC=$TOP/srs
SRC=$TOP/include 
workdir=$TOP/IncludeTemp

if [ ! -d $workdir ]; then
   mkdir $workdir
fi

LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/usr/local/lib/graphviz"
export LD_LIBRARY_PATH

# start with a clean slate
cd $workdir
rm -f *
cd $TOP/doc
rm -rf html rtf

# preprocess source code and put output into workdir
cd $SRC
find . -type f | grep '\.[Cch]$' | while read x ; do
	$TOP/bin/trans_qprop <$x >$workdir/$x
done

SRC=$TOP/addons/table.tree

# preprocess source code and put output into workdir
cd $SRC
find . -type f | grep '\.[Cch]$' | while read x ; do
	$TOP/bin/trans_qprop <$x >$workdir/$x
done

SRC=$TOP/addons/printing

# preprocess source code and put output into workdir
cd $SRC
find . -type f | grep '\.[Cch]$' | while read x ; do
	$TOP/bin/trans_qprop <$x >$workdir/$x
done

SRC=$TOP/addons/kdchart

# preprocess source code and put output into workdir
cd $SRC
find . -type f | grep '\.[Cch]$' | while read x ; do
	$TOP/bin/trans_qprop <$x >$workdir/$x
done

SRC=$TOP/addons/table.html

# preprocess source code and put output into workdir
cd $SRC
find . -type f | grep '\.[Cch]$' | while read x ; do
	$TOP/bin/trans_qprop <$x >$workdir/$x
done

# copy other source docs into workdir
cd $TOP/doc
cp *.{doc,html} $workdir


cd $TOP
#doxygen $TOP/config/qicstable.cfg
#/ICS/Users/craig/tmp/doxygen-1.3.2/bin/doxygen $TOP/config/qicstable.cfg
doxygen $TOP/config/qicstable.cfg
xsltproc $TOP/config/tag2dcf.xsl $TOP/doc/qicstable.tag > $TOP/doc/QicsTable.dcf

cd $TOP/doc
cp *.jpg html
cp *.png html

rm -fr $workdir
